$(document).ready(function(){

	var level = 0;
	var tileset = 0;

	var helptext = [ 'Background for this level will be a randomly generate forest skyline using the dark blue forest tiles',
					 'Background for this level will be a uniform brick wall using the blue bricks, windows and candles',
					];

var data = [
'..........................................................................................................................................................................................................................................................................................................................VUuv.....n.N................n.N......................................................................Tt.....Ghhhg......n.......GHHHg............................................................e........Tt..............Imm..................N...n...ne.N...n....................................Ghhhg......Ttn............IJoo................Immm.Ghhhhhhhhg.mmm.............................................Immmi..........IJsbblkn.......N....IJsoo............ooo................................nlk.N..n....IJsooji........IJsbbbmmm......mmmilIJsbbb...........Ibbb...............................mmmmmmmmm..kIJsbbboji......IJsbbbbooon.L...ooojmJsbbbb......KL..IJbbb...............................ooooooooo..mJsbbbbboji.nkLIJsbbbbbbbbmmm...bbbooobbbbbmmmmmmmmmmJsbbb..........................mmmmmbbbbbbbbbffoobbbbbbbojmmmmJsbbbbbbbbboooFFFbbbbbbbbbbbooooooooooobbbb..........................ooooo0',
'...........................................................................................................................................................................................................................................................................................................................................................................................................................VUuv.................................................................................................Tt.............VUuv.................................................................................Tt..............Tt.............................................................................VUuv.Tt..............Tt.......................................................................NkLn...Tt..Tt..............Tt......................................................................mmmmmi..Tt..Tt.....VUuv.....Tt......................................................................OOOOSj..Tt..Tt......Tt......Tt......................................................................BBBBBS..Tt..Tt......Tt......Tt......................................................................0',
'bbbbbbbbbbbbbbBBBBbbbbbBbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb.............................................bbbbbbbbbgttttttttttvttGbgttttttGbgtttttttttttttttttttt.............................................bbbbbbbbbg..........d..Gbg......Gbg.................................................................bbbbbbbbbg..........d..GPg......ttt.................................................................tttttttvtt..........d..Gbg.................................................................................d............d..ttt..........IhhF..............f....................................................d............d..............IJbPg.........XWwx.G....................................................d............c.............IJbbbg..............G....................................................d...........IhhHi.........IJbbbbg..............G....................................................c.....l....IJBPbjhhhF.XwwxGbbbbbg..............G.................................................IHHHHHHHHF..fhJBBBbbbbbgyyyyyGbbbbbg..............G.............................................HHHHJBBBBBBBBgyyGbBBBBbbbbbgZZZZZGbbbbbgYYYYYYYYYYYYYYG.............................................1',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................0'
];

	// build table
	var height = 12;
	var width = 100;

	var table = $('#grid');
	var tbody = table.find('tbody');
	for (var y = 0; y < height; y++) {
		var row = "<tr class='cell'>";
		for (var x = 0; x < width; x++) {
			row += "<td data-id='.' data-counter='" + (y * width + x) + "'></td>";
		}
		row += "</tr>\n";
		tbody.append(row);
	}

	var setHelpText = function() {
		var l = $('#helptext');
		l.html(helptext[tileset]);
	}

	var buildtilemap = function() {
		// build tilemap
		var l = $('div.fixed ul#lower');

		l.empty();

		l.append('<li data-id="."></li>');
		for (var i = 0; i < 26; i++) {
			var style = 'width: 64px; height: 64px; background: url(spritesheet.png) ' + ( i * -64 ) + 'px ' + (tileset * 64) + 'px; background-size: 2600%;';
			l.append('<li data-id="' + String.fromCharCode( i + 97) + '" class="tile" style="' + style + '"></li>');
		}

		var l = $('div.fixed ul#upper');

		l.empty();

		l.append('<li data-id="."></li>');
		for (var i = 0; i < 26; i++) {
			var style = 'width: 64px; height: 64px; background: url(spritesheet.png) ' + ( i * -64 ) + 'px ' + (tileset * 64) + 'px; background-size: 2600%;';
			l.append('<li data-id="' + String.fromCharCode( i + 65) + '" class="tile flipped" style="' + style + '"></li>');
		}

		// handle li click
		$("div.fixed ul li").click(function() {
			// clear selection from old
			if ( selected !== null ) {
				selected.removeClass('selected');
			}
			$(this).addClass('selected');

			selected = $(this);
		});

		setHelpText();
	}

	buildtilemap();

	// handle selection
	var selected = null;

	// handle li click
	/* $("div.fixed ul li").click(function() {
		// clear selection from old
		if ( selected !== null ) {
			selected.removeClass('selected');
		}
		$(this).addClass('selected');

		selected = $(this);
	}); */

	var replaceAt = function(index, character, string) {
	    return string.substr(0, index) + character + string.substr(index+character.length);
	};

	// handle cell click
	$("tr.cell td").click(function(e) {
		if ( selected !== null ) {
			var value = $(selected).data("id");

			var counter = parseInt($(this).data("counter"), 10);
			$(this).data('id', value);
			var v = value.charCodeAt(0);

			//console.log( counter + ',' + data[level][counter] );
			data[level] = replaceAt( counter, value, data[level] );
			//console.log( counter + ',' + data[level][counter] );

			var flipped = false;

			if ( v > 96 ) {
				v -= 97;
				flipped = false;
			} else {
				v -= 65;
				flipped = true;
			}

			if (value !== '.' ) {
				$(this).css('background', 'url(spritesheet.png) ' + (v * -64) + 'px ' + (tileset * 64) + 'px');
				$(this).css('background-size', '2600%');
				if (flipped) {
					$(this).addClass('flipped');
				} else {
					$(this).removeClass('flipped');
				}
			}
			else
			{
				$(this).css('background', '');
				$(this).css('background-size', '');
				$(this).removeClass('flipped');
			}

		}
	});

	// click on export button
	$("#export").click(function(e) {
		e.preventDefault();
		var result = '';
		$("#grid tr").each(function () {
			$('td', this).each(function () {
				var value = $(this).data( "id" );
				result += value;
			 });
		});
		result += tileset;

		console.log('-----------[ LEVEL ' + level + ' ]------------');
		console.log( result );
		console.log('---------------------------------------------');
	});

	var setLevelIndicator = function() {
		$('#levelindicator').html('' + level);
		$('#tilesetindicator').html('' + tileset);
	};

	var loadData = function() {
		var counter = 0;

		tileset = parseInt(data[level][1200],10);
		buildtilemap();

		$("#grid tr").each(function () {
			$('td', this).each(function () {
				$(this).data( "id", data[level][counter] );

				var value = data[level][counter];

				var v = value.charCodeAt(0);

				var flipped = false;

				if ( v > 96 ) {
					v -= 97;
					flipped = false;
				} else {
					v -= 65;
					flipped = true;
				}

				if (value !== '.' ) {
					$(this).css('background', 'url(spritesheet.png) ' + (v * -64) + 'px ' + (tileset * 64) + 'px');
					$(this).css('background-size', '2600%');
					if (flipped) {
						$(this).addClass('flipped');
					} else {
						$(this).removeClass('flipped');
					}
				}
				else
				{
					$(this).css('background', '');
					$(this).css('background-size', '');
					$(this).removeClass('flipped');
				}

				counter++;
			 });
		});

	};

	// load level
	/*
	$("#load").click(function(e) {
		e.preventDefault();

		loadData();
	}); */

	// prev button
	$("#prev").click(function(e) {
		e.preventDefault();

		if ( level > 0) {
			level--;
			loadData();
		}
		setLevelIndicator();
	});
	// next button
	$("#next").click(function(e) {
		e.preventDefault();

		if ( level < 8) {
			level++;
			loadData();
		}
		setLevelIndicator();
	});

	// prev button
	$("#prevtileset").click(function(e) {
		e.preventDefault();

		if ( tileset > 0) {
			tileset--;
			data[level] = replaceAt( 1200, tileset, data[level] );
			buildtilemap();
			loadData();
		}
		setLevelIndicator();
	});
	// next button
	$("#nexttileset").click(function(e) {
		e.preventDefault();

		if ( tileset < 1) {
			tileset++;
			data[level] = replaceAt( 1200, tileset, data[level] );
			buildtilemap();
			loadData();
		}
		setLevelIndicator();
	});

	loadData();
});
