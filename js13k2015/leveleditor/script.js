$(document).ready(function(){

	var level = 0;

var data = [
'..........................................................................................................................................................................................................................................................................................................................VUuv.....n.N.........................................................................................Tt.....Ghhhg......n........................................................................e........Tt..............Imm......................................................................Ghhhg......Tt.............IJoo................................................................................Immmi..........IJsbbL..................................................................nlk.N..w....IJsooji........IJsbbbmmm......mmm......................................................mmmmmmmmm..kIJsbbboji......IJsbbbbooo..L...bbb......................................................ooooooooo..mJsbbbbboji.nkLIJsbbbbbbbbmmm...bbb......................................................bbbbbbbbbffoobbbbbbbojmmmmJsbbbbbbbbboooFFFbbb....................................................Fb',
'...........................................................................................................................................................................................................................................................................................................................................................................................................................VUuv.................................................................................................Tt.............VUuv.................................................................................Tt..............Tt.............................................................................VUuv.Tt..............Tt.......................................................................NkLn...Tt..Tt..............Tt......................................................................mmmmmi..Tt..Tt.....VUuv.....Tt......................................................................OOOOSj..Tt..Tt......Tt......Tt......................................................................BBBBBS..Tt..Tt......Tt......Tt......................................................................',
'...........................................................................................................................................................................................................................L...............................................................................................L................................................................................................................................................................................................................L.L.....L....................................................................................................................................................................................................L..L.........................................................................................L..............................................................................................L..........................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................',
'................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................'
];

	// build table
	var height = 12;
	var width = 100;

	var table = $('#grid');
	var tbody = table.find('tbody');
	for (var y = 0; y < height; y++) {
		var row = "<tr class='cell'>";
		for (var x = 0; x < width; x++) {
			row += "<td data-id='.' data-counter='" + (y * width + x) + "'></td>";
		}
		row += "</tr>\n";
		tbody.append(row);
	}

	// build tilemap
	var l = $('div.fixed ul#lower');
	l.append('<li data-id="."></li>');
	for (var i = 0; i < 26; i++) {
		var style = 'width: 64px; height: 64px; background: url(spritesheet.png) ' + ( i * -64 ) + 'px 0px; background-size: 2600%;';
		l.append('<li data-id="' + String.fromCharCode( i + 97) + '" class="tile" style="' + style + '"></li>');
	}

	var l = $('div.fixed ul#upper');
	l.append('<li data-id="."></li>');
	for (var i = 0; i < 26; i++) {
		var style = 'width: 64px; height: 64px; background: url(spritesheet.png) ' + ( i * -64 ) + 'px 0px; background-size: 2600%;';
		l.append('<li data-id="' + String.fromCharCode( i + 65) + '" class="tile flipped" style="' + style + '"></li>');
	}

	// handle selection
	var selected = null;

	// handle li click
	$("div.fixed ul li").click(function() {
		// clear selection from old
		if ( selected !== null ) {
			selected.removeClass('selected');
		}
		$(this).addClass('selected');

		selected = $(this);
	});

	var replaceAt = function(index, character, string) {
	    return string.substr(0, index) + character + string.substr(index+character.length);
	};

	// handle cell click
	$("tr.cell td").click(function(e) {
		if ( selected !== null ) {
			var value = $(selected).data("id");

			var counter = parseInt($(this).data("counter"), 10);
			$(this).data('id', value);
			var v = value.charCodeAt(0);

			//console.log( counter + ',' + data[level][counter] );
			data[level] = replaceAt( counter, value, data[level] );
			//console.log( counter + ',' + data[level][counter] );

			var flipped = false;

			if ( v > 96 ) {
				v -= 97;
				flipped = false;
			} else {
				v -= 65;
				flipped = true;
			}

			if (value !== '.' ) {
				$(this).css('background', 'url(spritesheet.png) ' + (v * -64) + 'px 0px');
				$(this).css('background-size', '2600%');
				if (flipped) {
					$(this).addClass('flipped');
				} else {
					$(this).removeClass('flipped');
				}
			}
			else
			{
				$(this).css('background', '');
				$(this).css('background-size', '');
				$(this).removeClass('flipped');
			}

		}
	});

	// click on export button
	$("#export").click(function(e) {
		e.preventDefault();
		var result = '';
		$("#grid tr").each(function () {
			$('td', this).each(function () {
				var value = $(this).data( "id" );
				result += value;
			 });
		});

		console.log('-----------[ LEVEL ' + level + ' ]------------');
		console.log( result );
		console.log('---------------------------------------------');
	});

	var setLevelIndicator = function() {
		$('#levelindicator').html('' + level);
	};

	var loadData = function() {
		var counter = 0;

		$("#grid tr").each(function () {
			$('td', this).each(function () {
				$(this).data( "id", data[level][counter] );

				var value = data[level][counter];

				var v = value.charCodeAt(0);

				var flipped = false;

				if ( v > 96 ) {
					v -= 97;
					flipped = false;
				} else {
					v -= 65;
					flipped = true;
				}

				if (value !== '.' ) {
					$(this).css('background', 'url(spritesheet.png) ' + (v * -64) + 'px 0px');
					$(this).css('background-size', '2600%');
					if (flipped) {
						$(this).addClass('flipped');
					} else {
						$(this).removeClass('flipped');
					}
				}
				else
				{
					$(this).css('background', '');
					$(this).css('background-size', '');
					$(this).removeClass('flipped');
				}

				counter++;
			 });
		});
	};

	// load level
	/*
	$("#load").click(function(e) {
		e.preventDefault();

		loadData();
	}); */

	// prev button
	$("#prev").click(function(e) {
		e.preventDefault();

		if ( level > 0) {
			level--;
			loadData();
		}
		setLevelIndicator();
	});
	// next button
	$("#next").click(function(e) {
		e.preventDefault();

		if ( level < 8) {
			level++;
			loadData();
		}
		setLevelIndicator();
	});

	loadData();
});
