!function t(i,s,h){function e(b,n){if(!s[b]){if(!i[b]){var r="function"==typeof require&&require;if(!n&&r)return r(b,!0);if(a)return a(b,!0);var o=new Error("Cannot find module '"+b+"'");throw o.code="MODULE_NOT_FOUND",o}var l=s[b]={exports:{}};i[b][0].call(l.exports,function(t){var s=i[b][1][t];return e(s?s:t)},l,l.exports,t,i,s,h)}return s[b].exports}for(var a="function"==typeof require&&require,b=0;b<h.length;b++)e(h[b]);return e}({1:[function(t){!function(){"use strict";var i=t(6),s=t(12),h=t(8),e=null,a=0,b=1,n=2,r=3,o=function(){var t=this;this.images=[];var h=document.querySelector("#game");this.ctx=h.getContext("2d"),this.ctx.imageSmoothingEnabled=this.ctx.mozImageSmoothingEnabled=this.ctx.oImageSmoothingEnabled=!1,this.gameSize={width:h.width,height:h.height},this.state=a,this.keyboarder=new i,this.loadingScreen=new s(this,"#000",["Loading..."]),this.titleScreen=new s(this,"#6b036e",["Super Knight Rescue","made for #js13k","Code by","madmarcel","Art by","surt & madmarcel"],"S","start",n),this.loadImages();var e=1e3/60,b=function(){t.render(),requestAnimationFrame(b)};b();var r=function(){t.update(),setTimeout(r,e)};r()};o.prototype={render:function(){switch(this.ctx.clearRect(0,0,this.gameSize.width,this.gameSize.height),this.state){case a:this.loadingScreen.render(this.ctx);break;case b:this.titleScreen.render(this.ctx);break;case r:this.level.render(this.ctx)}},update:function(){switch(this.state){case a:this.loadingScreen.update();break;case b:this.titleScreen.update();break;case n:this.level=new h(0,this,!1),this.state=r;break;case r:this.level.update()}},loadImages:function(){for(var t=this,i=["spritesheet"],s=function(s){s>=i.length&&(t.titleScreen.lvl=new h(0,t,!0),t.state=b)},e=0,a=0;a<i.length;a++){var n=new Image;n.onload=function(){e++,s(e)},n.src=i[a]+".png",t.images[a]=n}}},window.addEventListener("load",function(){e=new o})}()},{12:12,6:6,8:8}],2:[function(t,i){"use strict";var s=function(t,i){this.ss=t,this.data=i,this.c=0,this.s=4,this.ts=(new Date).getTime()};s.prototype={render:function(t,i,s,h){this.data;i?t.drawImage(this.ss,this.f(0),this.f(1),this.f(2),this.f(3),s,h,this.f(2)*this.s,this.f(3)*this.s):(t.save(),t.translate(t.canvas.width,0),t.scale(-1,1),t.drawImage(this.ss,this.f(0),this.f(1),this.f(2),this.f(3),t.canvas.width-s-this.f(2)*this.s,h,this.f(2)*this.s,this.f(3)*this.s),t.restore())},update:function(){var t=(new Date).getTime();t-this.ts>this.f(4)&&(this.ts=t,this.c=this.f(5))},next:function(){},set:function(){},f:function(t){return this.data[t+6*this.c]}},i.exports=s},{}],3:[function(t,i){"use strict";function s(t,i,s,e,a){this.lvl=t,this.x=i,this.y=s,this.width=64,this.height=64,this.velX=0,this.velY=0,this.speed=.5,this.gravity=.9,this.friction=.9,this.goingLeft=this.dead=!1,this.isMonster=this.grounded=!0,this.harmless=!1;var b=[112,32,16,16,300,1,128,32,16,16,300,2,144,32,16,16,300,3,160,32,16,16,300,4,144,32,16,16,300,5,128,32,16,16,300,0],n=[160,32,16,16,300,4];if(this.t=a,1===a&&(b=[176,32,16,16,400,1,192,32,16,16,400,0],n=[208,32,16,16,1e3,0],this.speed=.25),2===a&&(this.harmless=!0,this.speed=0,b=n=[48,48,16,16,1e3,0]),3===a&&(this.harmless=!0,this.speed=0,b=n=[48,32,16,16,1e3,0]),2>a&&e){for(var r=1;r<b.length;r+=6)b[r]+=16;n[1]+=16}this.anim=new h(this.lvl.parent.images[0],b),this.shan=new h(this.lvl.parent.images[0],n),this.blo=[],this.state=0,this.grabbed=!1,this.id=this.guid()}var h=t(2);s.prototype={guid:function(){var t=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},update:function(){if(this.dead)return this.y<800&&(this.velX=2,this.goingLeft&&(this.velX=-2),this.velY=15,this.y+=this.velY,this.x+=this.velX),void 0;if(1===this.state);else{this.t<2&&(this.goingLeft?this.velX>-this.speed&&this.velX--:this.velX<this.speed&&this.velX++),this.velX*=this.friction,this.velY+=this.gravity,this.grounded=!1;var t=this.blo,i=-1;this.goingLeft&&t.reverse(),this.state>0&&(t=t.filter(function(t){return!t.isPlayer&&!t.mb}));for(var s=this.lvl.player,h=0;h<t.length;h++)if(t[h].y!==i){var e=s.colCheck(this,t[h]);null!==e&&2===this.state&&t[h].isMonster&&!t[h].harmless&&(t[h].dead=!0,this.dead=!0),null!==e&&(this.state=0,this.grabbed=!1),"l"===e||"r"===e?s.onSlope(t[h],this)?i=t[h].y:(this.velX=0,this.harmless||(this.goingLeft=!this.goingLeft)):"b"===e&&(s.onSlope(t[h],this)?i=t[h].y:(this.grounded=!0,t[h].pl&&this.velX<.2&&(this.x+=2*t[h].velX)))}this.grounded&&(this.velY=0,this.state=0),this.x+this.velX>0&&this.x+this.width+this.velX<this.lvl.width&&(this.x+=this.velX),this.y+=this.velY}this.anim.update()},render:function(t){this.y<800&&(this.state>0?this.shan.render(t,this.goingLeft,this.x+this.lvl.viewport.x,this.y):this.anim.render(t,this.goingLeft,this.x+this.lvl.viewport.x,this.y))},blockfilter:function(t){return t.exit||t.pickup||t.next||t.dest?!1:t.id&&t.id===this.id?!1:!0},grab:function(){this.state=1,this.grabbed=!0},chuck:function(t,i){this.state=2,this.velX=10,(t>.3||-.3>t)&&(this.velX=25),this.goingLeft&&(this.velX*=-1),this.velX+=t,this.velY=-6+i}},i.exports=s},{2:2}],4:[function(t,i){"use strict";function s(t,i,s,h){this.x=t,this.y=i,this.width=s,this.height=h,this.tr=this.tl=this.dead=this.pickup=this.exit=this.pl=this.mb=this.next=this.dest=this.kill=!1}i.exports=s},{}],5:[function(t,i){"use strict";function s(t,i,s,e,a,b,n){this.lvl=t,this.x=i,this.y=s,this.fb=!0,this.width=32,this.height=32,this.dead=!1,this.kill=!0,this.velX=e,this.velY=a,this.sx=b,this.sy=n;var r=[256,49,8,8,50,1,264,49,8,8,50,0];this.anim=new h(this.lvl.parent.images[0],r)}var h=t(2);s.prototype={update:function(){this.dead||(this.anim.update(),this.x+=this.velX,this.y+=this.velY,this.velX+=this.sx,this.velY+=this.sy,(this.x<0||this.y<0||this.y>800||this.x>3e3)&&(this.dead=!0))},render:function(t){if(!this.dead){var i=this.x+this.lvl.viewport.x;this.anim.render(t,!0,i,this.y)}}},i.exports=s},{2:2}],6:[function(t,i){"use strict";var s=function(){var t=this;this.keyState={},window.addEventListener("keydown",function(i){t.preventKeys.indexOf(i.keyCode)>-1&&(i.preventDefault(),i.stopPropagation()),t.keyState[i.keyCode]=!0}),window.addEventListener("keyup",function(i){t.keyState[i.keyCode]=!1}),this.KEYS={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,ENTER:13,ESC:27};for(var i=65;91>i;i++)this.KEYS[String.fromCharCode(i)]=i;this.preventKeys=[this.KEYS.LEFT,this.KEYS.RIGHT,this.KEYS.UP,this.KEYS.DOWN,this.KEYS.SPACE,this.KEYS.ENTER,this.KEYS.ESC]};s.prototype={isDown:function(t){return this.keyState[this.KEYS[t]]===!0},isUp:function(t){return this.keyState[this.KEYS[t]]===!1}},i.exports=s},{}],7:[function(t,i){"use strict";function s(t,i,s,e){this.lvl=t,this.x=i,this.y=s,this.width=56,this.height=108,this.dead=this.door=this.pickup=this.isKnight=!1;var a=[[333,32,14,27,1e3,0],[347,32,24,17,1e3,0],[64,48,16,16,1e3,0],[240,48,16,16,1e3,0]];this.anim1=new h(this.lvl.parent.images[0],a[0]),this.anim2=new h(this.lvl.parent.images[0],a[1]),0===e?this.isKnight=!0:1===e?(this.anim1.data=a[2],this.width=this.height=64,this.door=!0):(this.anim1.data=a[3],this.width=this.height=64,this.pickup=!0),this.t=e}var h=t(2);s.prototype={update:function(){},render:function(t){if(!this.dead){var i=this.x+this.lvl.viewport.x;this.t>0?this.anim1.render(t,!0,i,this.y):(this.anim1.render(t,!0,i,this.y),this.anim2.render(t,!0,i+50,this.y-50),t.font="50px Arial",t.fillStyle="#fff",t.fillText("The End",i+20,this.y-100))}}},i.exports=s},{2:2}],8:[function(t,i){"use strict";function s(t,i,s){this.number=t,this.player=null,this.dud=s,this.data=["..............................................&&&.................................................................................................&&&..................................nlkn........................*..................................&&&.................................Immmmi.....................................................777..&&&...............................nIJsoooji.......888...........$..(...$.@.....................333..&&&..777.........................ImJsbbbboji......444............VcUucv..Xdx.$...]$............353.}&&&..333......................nnIJsobbbbbboji.....464..............Tt.........VUuv............n3%3NI&&&i.353.........*...........ImmJsbbbbbbbbboji....444..............Tt..........Tt............ImmmmmJ&&&ji3^3....................IJsoobbbbbbbbbbboji...444..............Tt......1...Tt..kL.......IJsooooo&&&ojmmmmg......&&.........IJsbbbbbbbbbbbbbbboji..464..~n$lkn.]1+n.Tt.N.n-11{.NTtnImmi)$$nLIJsbbbbbb&&&booooo.................IJsbbbbbbbbbbbbbbbbboji.4!4.mmmmmmmmmmmmmmMMMMMMMMMMMMMMJsojmgGmmJsbbbbbbb&&&bb[...................GJsbbbbbbbbbbbbbbbbbbbojmmmmmooooooooobbbboooooooooooooooobboofFooobbbbbbbb&&&bbfffffffffffffffffffffobbbbbbbbbbbbbbbbbbbbboooooo0",".............................................................................................................................$...............................................*..........................888.................................................@...............$..+.$......................888.444...............................$.(..$.....VcUucv$Xx.....$.....Xx$VcUucv......................444.464.......VcUucv..................VcUuCv.......Tt.....................Tt........................464.444.........Tt.............VUuv.....Tt.........Tt.....................Tt........................444.444.........Tt..............Tt......Tt.........Tt.....................Tt...........VUuv.........444.464....VUuv.Tt..............Tt......Tt.........Tt.....................Tt............Tt..........464.4a4~n...Tt..Tt....$...]$#...Tt......Tt.........Tt.....................Tt.$..(...$...Tt......NkLN4!4Nmmmmmi..Tt..Tt....VCUucvXdx.Tt......Tt.........Tt..$......].$.........Tt.VccUuCCv...Tt.....ImmmmmmmmOOOOSj..Tt..Tt......Tt......TtVcUucvTt...VcUucvTt..VcccUuCCCv.....VUuvTt....Tt......Tt.....JsoooooooBBBBBS..Tt..Tt......Tt...$..Tt..Tt..TtVUuv.Tt..Tt......Tt...VUuv...Tt.Tt....Tt......Tt.....sbbbbbbbb0","....ImmmJBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBSjmi........i.~.BBBBBBEaaaaaaaaaaWBBBBBBBBBBBBBBBBEaaaaaaaaaWBBBBEaaaaWBEaaaaaAAaaaWBBBBBBBBBBBBBBBBBOOE........BAAAWBBBBEaaaaaaaaaaaaBBBBBBBBBBBBBEaaaaaa]09aaaaWBBBa{aaaaaaaaaaaAAaaaaaaaaaaaWBBBBBBBEaaaa........BAAAAWBBEaaaaaa$-09a$aWBBBBBBBBBBEaaaaa]aYBBBBZaaaBBBZaaaaaaaa090$$Aaaaa09aaaaaaaWBBBBEaaaaa.....888BAAAAAaaaaaaaaazbbbbyaaWBBBBBBBBEaaaaYBBBBBBBBBZaaWBBBZ0a09aYBBBBZAAaaaYBBZaaaaaaaaaaaaaaaaa.....444BAAAAAaaaaaaaaaebbbbwaaaaaaaaaaaaa0YBBBBBBBBBBBBZaaBBBBBBBBBBBBBBEAAaaaBBBBBZaaaaaaaaaaaaaaa.....464BAAAAAaaaaaaaaaaaaaaaaaaaaaaaaaaaYBBBBBBEaaaaWBBBaaBBBBBBBBBEaaaaaAAaaaBBBBBBZ09aaaaaaaaaaaaN....444BAAAAAaaaaaaaaaaaaaaaaaaaaaa$09YBBBBBEaaaaaaaaWBEaaBBBBEaaaaaaaaaaAAaaaBBBBBBBBBaaaaaaaaaa0Ymi...444BZAAAAaa90aaaaaaaaaaaaa09aaaYBBBBBBBBaaaaaa0aaaaaaaWBEaaaaaaa$0aaaAAaaaBBBBBBBBEaaaaaaaaaYBBSji..464BBZAAAaYBBZa)aaaaaaaaaYBBZ$aBBBBBBBBBaaaaaYBZaaaaaaaaaaa0a09YBBZaa#AaaaWBBBBBBEaaa@aaaaaYBBBBSji.4!4BBBZaYBBBBBBBBZa09a{aYBBBBaaBBBBBBBBBZ09YBBBBZaa+aa09aYBBBBBBBBBZaXdxaaaBBBBBBaaaaXxaaaaBBBBBBSjMmmmBBBBBBBBBBBBBBBBBBBBBBBBBEaaWBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBa$AaaaaWBBBBEaaaaaaaaaaWBBBBBBOOOOO0","bbbbbbbbbbbbbbBBBBbbbbbBbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbgttttttttttvttGbgttttttGbgttttttttttttttttttttttttVtttttttVtttttttVtttttttVtttttttttttttttGbbbbbbbbbg..........d..Gbg......Gbg........................D.......D.......D.......D...............Gbbbbbbbbbg..........d..GPg......ttt........................D.......D.......D.......D...............Gtttttttvtt..........d.*Gbg.................................D.......D.......D.......D...............G.......d............d..ttt..........IhhF..............fHF..D.......D.......D.......D...............G.......d............d..............IJbPg#........XWwx@Gbg..D.......D.......D.......D...............G.......d............c.............IJbbbg..............Gbg..D.......D.......D.......D...............G.......d...........IhhHi.........IJbbbbg..............Gbg..D.......D.......D.......D...............G.......c.....l....IJBPbjhhhF#.Xx@Gbbbbbg..............Gbg..D.......D.......D.......D.............!.G.~..IHHHHHHHHF..fhJBBBbbbbbgyyyyyGbbbbbg..............Gbji.C.......C.......C.......C.............!IJHHHHJBBBBBBBBgyyGbBBBBbbbbbgZZZZZGbbbbbgYYYYYYYYYYYYYYGbbjHhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhJb1","bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb..................................TTTTVTTTTTTT333GbbbbgttttVttttttVtttVttGbgtTTTVtTTTTVTTTGbbbbbbbbb......................................D.......333Gbbbbg....D......D...D..Gbg....D.....D...Gbbbbbbbbb......................................D.......353Gbbbbg1...D......D...D..Gbg....D.....D...Gbbbbbbbbb......................................D......L3%3Gbbbbg11..D......D...D..Gbg....D.....D...Gbbbbbbbbb......................................D......&&&&Gbbbbg&&&.D...&..D...D..Gbg....D.....D...Gbbbbbbbbb......................................D....l&&&&&Gbbbbg333.D&.....D...D..Gbg....D.....D...Gbbbbbbbbb......................................D....&&&&&&Gbbbbg333.D......D...D..AAA....D.....D...Gbbbbbbbbb......................................D...&&&&&&&Gbbbbg333&D......D...D..AAA....C..U..C...Gbbbbbbbbb......................................D..&&&&&&&&Gbbbbg353.D...$..C.u.Cl$AAA....&&&&&&&...Gbbbbbbbbb...................................~.nC.&&&&&&&&&Gbbbbg3^3.C...n&&&&&&&&&AAA...&&&&&&&&&..Gbbbbbbbbb..................................hhhhhhhhhhhhhhhBbbbbbmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmbbbbbbbbbb..................................1"],this.parent=i,this.height=12,this.width=0,this.tilesize=16,this.scale=4,this.tileset=0,s&&(this.number=this.rand(0,this.data.length-1)),this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)}var h=t(10),e=t(13),a=t(9),b=t(4),n=t(3),r=t(11),o=t(7);s.prototype={rand:function(t,i){return Math.floor(Math.random()*(i-t+1))+t},genBG:function(t,i,s){if(1===this.tileset){for(var h=[10,15,16,17],e=0,a=0,b=0;100>b;b++)e=this.rand(0,i-1),a=this.rand(0,s-1),t[e][a]=14;for(a=5,e=this.rand(5,8);i>e;e+=this.rand(4,7)){var n=this.rand(0,3);a=this.rand(3,5),t[e][a]=h[n],3===n&&(t[e][a+1]=h[n]+1)}}else for(var r=[[17,0],[-16,-17],[16,15]],b=[[1,1,2,0],[0,0,1,1,2,0],[0,-1,2,-1,1,0]],o=0,l=0,B=this.rand(4,8),d=0;i>d;d++){t[d][B]=r[o][0],t[d][B+1]=r[o][1];for(var v=B+2;v<this.height;v++)t[d][v]=0;if(B>9){for(var g=-1;0>g;)l=2*this.rand(0,b[o].length/2-1),g=b[o][l+1];B-=b[o][l+1],o=b[o][l]}else if(2>B){for(var g=1;g>0;)l=2*this.rand(0,b[o].length/2-1),g=b[o][l+1];B-=b[o][l+1],o=b[o][l]}else l=2*this.rand(0,b[o].length/2-1),B-=b[o][l+1],o=b[o][l]}},genBlockers:function(t,i,s){this.blockers=[];var e=[];this.emptyTilemap(e,i,s,this.tileset-1);for(var l=this.tilesize*this.scale,B={player:["~"],exit:["!","%","^"],blob:["-","+","(",")"],gblob:["(",")"],lblob:[")","+"],turt:["[","]","{","}"],bturt:["{","}"],lturt:["]","}"],items:["1","2"],chilli:["*"],monsterblock:["$"],ignore:["3","4","5","6","7","8","9","0","@","#"]},d=[{t_l:[-24,-8,25],t_r:[8,-7,24],ign:[6,-26,10,-22,11,-21,-13,19,-19,13,-32,0],half:[7,-25,-11,21,-12,20,-30,2,-28,4,-10,22],plat:[-29,3,-9,23],dead:[5,-27],item:[],boss:[],kni:[],door:[]},{t_l:[-24],t_r:[8],ign:[-21,11,-19,13,-30,2,-29,3,-17,15,-16,16],half:[-13,19,-11,21],plat:[-10,22,-9,23],dead:[-7,25,-8,24],item:[],boss:[20],kni:[-12],door:[-32]}],v=[],g=d[this.tileset],f=B,u=0;s>u;u++)for(var c=0;i>c;c++){var m=t[c][u],p=String.fromCharCode(m+97);if(-51!==m){var w=new b(c*l,u*l,l,l),x=!1;if(this.io(f.player,p)&&(x=!0,this.player=new h(this.parent,c*l,u*l,this.viewport),t[c][u]=-51,this.chkCave(t,c,u)),this.io(f.monsterblock,p)&&(w.mb=!0,x=!1,this.chkCave(t,c,u)),this.io(f.items,p)){x=!0;var y=new n(this,c*l,u*l,!1,"1"===p?2:3);this.things.push(y),this.blockers.push(y),t[c][u]=-51,this.chkCave(t,c,u)}if(this.io(f.blob,p)){x=!0;var y=new n(this,c*l,u*l,this.io(f.gblob,p),0);y.goingLeft=this.io(f.lblob,p),this.things.push(y),this.blockers.push(y),t[c][u]=-51,this.chkCave(t,c,u)}if(this.io(g.boss,m)){x=!0;var T=new r(this,c*l,u*l);this.things.push(T),this.blockers.push(T),t[c][u]=-51}if(this.io(g.kni,m)){x=!0;var T=new o(this,c*l,u*l-44,0);this.things.push(T),this.blockers.push(T),t[c][u]=-51}if(this.io(f.chilli,p)){var T=new o(this,c*l,u*l,2);this.things.push(T),this.blockers.push(T),t[c][u]=-51,this.chkCave(t,c,u),x=!0}if(this.io(f.turt,p)){x=!0;var y=new n(this,c*l,u*l,this.io(f.bturt,p),1);y.goingLeft=this.io(f.lturt,p),this.things.push(y),this.blockers.push(y),t[c][u]=-51,this.chkCave(t,c,u)}if(this.io(f.ignore,p)&&(x=!0),this.io(f.exit,p)&&("%"===p?w.next=!0:"^"===p?w.dest=!0:w.exit=!0),this.io(g.door,m)){var T=new o(this,c*l,u*l,1);this.things.push(T),this.blockers.push(T),t[c][u]=-51,x=!0}if(this.io(g.plat,m)){var D=c*l,k=u*l,T=c,X=t[T][u],A=!1,Y=String.fromCharCode(t[T][u-1]+97);for(("#"===Y||"@"===Y)&&(t[c][u-1]=-51,this.chkCave(t,c,u-1),"#"===Y&&(A=!0));this.io(g.plat,X);)t[T][u]=-51,this.chkCave(t,T,u),T++,X=t[T][u];var S={b:null,c:null};this.createImage(T*l-D,l,S);var E=new a(this,S,T*l-D,l/2,D,k,A);E.init(this.tileset,this.tilesize,this.tilesize*this.scale,T-c),this.things.push(E),this.blockers.push(E),x=!0}this.io(g.t_l,m)?(w.tr=!0,v.push([c,u+1])):this.io(g.t_r,m)?(w.tl=!0,v.push([c,u+1])):this.io(g.half,m)?w.height=l/2:this.io(g.ign,m)?x=!0:this.io(g.dead,m)?(w.kill=!0,w.y+=l/2,w.height=l/2):this.io(g.item,m)&&(w.pickup=!0);for(var G=0;G<v.length;G++)v[G][0]===c&&v[G][1]===u&&(x=!0);x||this.blockers.push(w)}}this.player.boxes=this.blockers;for(var C=0;C<this.things.length;C++){var I=this.things[C];!I.isMonster||I.isKnight||I.pickup||(I.blo=this.blockers.filter(I.blockfilter,I))}},chkCave:function(t,i,s){(0===t[i-1][s]||0===t[i+1][s]||0===t[i][s-1])&&(t[i][s]=0)},init:function(t,i){this.viewport=new e(this.parent.gameSize);var s=[];this.tileset=parseInt(this.data[this.number][this.data[this.number].length-1],10),this.emptyTilemap(s,t.w,this.height,this.tileset-1),i?(this.convertTilemap(s,this.data[this.number],t.w),this.genBlockers(s,t.w,this.height)):this.genBG(s,t.w,this.height),this.createImage(t.w*this.tilesize*this.scale,this.parent.gameSize.height,t),this.drawTileMap(t.c,s,this.height,t.w)},update:function(){this.dud||this.player.update();for(var t=this.things.filter(this.viewport.vis,this.viewport),i=0;i<t.length;i++)t[i].update()},render:function(t){for(var i=0;i<this.buffers.length;i++)null!==this.buffers[i].b&&t.drawImage(this.buffers[i].b,Math.floor(this.buffers[i].xo),0,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height);if(!this.dud){var s=0,h=this.things.filter(this.viewport.vis,this.viewport);for(s=0;s<h.length;s++)h[s].render(t,Math.floor(this.viewport.x));this.player.render(t,Math.floor(this.buffers[1].xo))}},drawTile:function(t,i,s,h,e,a){if(!(0>i)){var b=this.tilesize*this.scale,n=this.tileset;a>-1&&(n=a),e?(t.save(),t.translate(t.canvas.width,0),t.scale(-1,1),t.drawImage(this.parent.images[0],i*this.tilesize,n*this.tilesize,this.tilesize,this.tilesize,t.canvas.width-s*b-b,h*b,b,b),t.restore()):t.drawImage(this.parent.images[0],i*this.tilesize,n*this.tilesize,this.tilesize,this.tilesize,s*b,h*b,b,b)}},createImage:function(t,i,s){var h=document.createElement("canvas");h.width=t,h.height=i;var e=h.getContext("2d");e.imageSmoothingEnabled=e.mozImageSmoothingEnabled=e.oImageSmoothingEnabled=!1,s.b=h,s.c=e},move:function(t){this.buffers[1].xo+=t,this.buffers[0].xo+=t/2},emptyTilemap:function(t,i,s,h){for(var e=0;i>e;e++){t[e]=[];for(var a=0;s>a;a++)t[e].push(h)}},convertTilemap:function(t,i,s){for(var h=0,e=0,a=0;a<i.length;a++)t[h][e]=i[a].charCodeAt()-97,h++,h>s-1&&(h=0,e++)},drawTileMap:function(t,i,s,h){for(var e=["4","6","8"],a=["3","5","7"],b=["!","%","^"],n=["&","9","0"],r=!1,o=-1,l=0;s>l;l++)for(var B=0;h>B;B++){var d=String.fromCharCode(i[B][l]+97);r=!1,i[B][l]<-6&&(i[B][l]+=32,r=!0),this.io(e,d)&&(o=2,i[B][l]=parseInt(d,10)/2+2,r=!1),this.io(a,d)&&(o=3,i[B][l]=(parseInt(d,10)+1)/2+2,r=!1),this.io(b,d)&&(i[B][l]=0,o=0),this.io(n,d)&&(o=2,i[B][l]=14,r=!1,"&"===d&&(i[B][l]=15),"0"===d&&(o=3)),this.drawTile(t,i[B][l],B,l,r,o),o=-1}},io:function(t,i){return t.indexOf(i)>-1},next:function(){this.number++,this.number>this.data.length-1&&(this.number=0),this.bl()},bl:function(){this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)},restart:function(t){this.bl(),this.player.lives=t},setup:function(){this.buffers=[{b:null,c:null,w:80,xo:0},{b:null,c:null,w:100,xo:0}],this.width=this.buffers[1].w*this.tilesize*this.scale,this.blockers=[],this.things=[],this.viewport=null}},i.exports=s},{10:10,11:11,13:13,3:3,4:4,7:7,9:9}],9:[function(t,i){"use strict";var s=function(t,i,s,h,e,a,b){this.x=e,this.y=a,this.width=s,this.height=h,this.lvl=t,this.buffer=i,this.velX=0,this.velY=0,this.speed=3,this.pl=!0,this.goesUp=b};s.prototype={render:function(t,i){t.drawImage(this.buffer.b,this.x+i,this.y)},update:function(){var t=this.lvl.blockers;t=t.filter(function(t){return!t.pl});for(var i=0;i<t.length;i++){var s=this.lvl.player.colCheck(this,t[i]);this.goesUp?("b"===s&&(this.velY=-1),"t"===s&&(this.velY=1)):("l"===s&&(this.velX=1),"r"===s&&(this.velX=-1))}this.x+=this.velX,this.y+=this.velY},init:function(t,i,s,h){var e=[[23,3,23],[23,22,23]],a=[],b=0;for(a.push(e[t][0]),b=0;h-2>b;b++)a.push(e[t][1]);a.push(e[t][2]);var n=!0;for(b=0;b<a.length;b++)this.lvl.drawTile(this.buffer.c,a[b],b,0,n,t),n=!1;this.goesUp?this.velY=1:this.velX=1}},i.exports=s},{}],10:[function(t,i){"use strict";function s(t,i,s,e){this.lives=3,this.chi=0,this.game=t,this.viewport=e,this.x=i,this.y=s,this.width=64,this.height=64,this.boxes=[],this.isPlayer=!0,this.mx=this.x+this.width/2,this.by=this.y+this.height,this.velX=0,this.velY=0,this.speed=5,this.jumping=!1,this.gravity=.2,this.grounded=!0,this.friction=.9,this.goingLeft=!1,this.vx=0,this.onPlatform=!1,this.holding=null;var a=[[16,32,16,8,1e3,0],[16,40,16,8,200,1,15,48,16,8,200,2,16,56,16,8,200,3,32,32,16,8,200,0],[33,40,15,14,1e3,0]],b=[[0,32,16,11,400,0],[0,54,16,11,400,0],[32,54,16,11,400,0],[347,49,25,16,1e3,0],[240,48,16,16,1e3,0]];this.ho=[[-12,12,0],[-12,12,0],[-12,12,-16]],this.cba=0,this.cha=0,this.ab=[new h(this.game.images[0],a[0]),new h(this.game.images[0],a[1]),new h(this.game.images[0],a[2])],this.ah=[new h(this.game.images[0],b[0]),new h(this.game.images[0],b[1]),new h(this.game.images[0],b[2]),new h(this.game.images[0],b[4])],this.ouch=new h(this.game.images[0],b[3]),this.release=!0}var h=t(2);s.prototype={died:function(){this.lives-=1,this.dead=!0},render:function(t){var i=this.x+this.viewport.x;this.ab[this.cba].render(t,this.goingLeft,i,this.y+32+this.ho[this.cha][2]),this.ah[this.cha].render(t,this.goingLeft,i+this.ho[this.cha][this.goingLeft?0:1],this.y-12),this.dead&&(this.ouch.render(t,!0,i+40,this.y-84),this.y>=790&&(t.fillStyle="#000",t.globalAlpha=.75,t.fillRect(262,200,500,250),t.globalAlpha=1,t.textAlign="center",t.fillStyle="#fff",t.font="35px Verdana",this.lives>0?this.drwLvs(t,440,270,0,this.lives):t.fillText("Game Over!",512,310),t.font="22px Verdana",t.fillText("Press R to continue",512,400))),this.drawHud(t)},drawHud:function(t){this.drwLvs(t,10,10,0,this.lives),this.drwLvs(t,10,60,3,this.chi)},drwLvs:function(t,i,s,h,e){t.font="35px Verdana",this.ah[h].render(t,!1,i,s),t.fillText("x "+e,i+110,s+40)},onSlope:function(t,i){if(t.tr||t.tl){var s=t.x,h=t.y+t.height;if(t.tr){var e=Math.floor(h-(i.x+i.width/2-s));i.y>=e-i.height&&(i.y=e-i.height,i.velY=0,i.grounded=!0,i.jumping=!1,this.cba=1,this.cha=1)}else if(t.tl){var e=Math.floor(h-(t.height-(i.x+i.width/2-s)));i.y>=e-i.height&&(i.y=e-i.height,i.velY=0,i.grounded=!0,i.jumping=!1,this.cba=1,this.cha=1)}return!0}return!1},update:function(){var t=this.game.keyboarder;if(this.dead){if(this.y<800)return this.velX=0,this.velY=4,this.y+=this.velY,this.cba=2,this.cha=2,this.ab[this.cba].update(),this.ah[this.cha].update(),void 0;t.isDown("R")&&(this.lives>0?this.game.level.restart(this.lives):this.game.state=1)}if(t.isDown("LEFT")&&(this.velX>-this.speed&&(this.velX--,this.grounded?(this.cba=1,this.cha=1):(this.cba=2,this.cha=2)),this.goingLeft=!0),t.isDown("RIGHT")&&(this.velX<this.speed&&(this.velX++,this.grounded?(this.cba=1,this.cha=1):(this.cba=2,this.cha=2)),this.goingLeft=!1),(t.isDown("SPACE")||t.isDown("UP"))&&!this.jumping&&this.grounded&&(this.jumping=!0,this.grounded=!1,this.velY=2*-this.speed,this.cba=2,this.cha=2),t.isUp("Z")&&(this.release=!0),t.isDown("Z"))if(null!==this.holding&&this.release)this.holding.chuck(this.velX,this.velY),this.holding=null;else if(null===this.holding&&!this.jumping&&this.grounded){var i=this.game.level.blockers.filter(this.viewport.vis,this.viewport);i=i.filter(function(t){return!t.dead&&t.isMonster&&!t.boss}),this.y+=1;for(var s=0;s<i.length;s++){var h=this.colCheck(this,i[s]);if("b"===h){this.holding=i[s],i[s].grab(),this.release=!1;break}}}this.velX*=this.friction,this.velY+=this.gravity,this.grounded=!1;var i=this.game.level.blockers.filter(this.viewport.vis,this.viewport);i=i.filter(function(t){return!(t.dest||t.mb||t.dead||t.grabbed)});var e=-1;this.goingLeft&&i.reverse();for(var s=0;s<i.length;s++)if(i[s].y!==e){var h=this.colCheck(this,i[s]);if("l"!==h&&"r"!==h||i[s].pickup?"b"!==h||i[s].pickup?"t"!==h||i[s].pickup||(this.velY*=-1):this.onSlope(i[s],this)?e=i[s].y:(this.onPlatform&&this.jumping&&this.velY<0||(this.grounded=!0,this.jumping=!1),this.onPlatform=!1,(i[s].pl&&!i[s].goesUp||i[s].isMonster)&&this.velX<.2&&(this.x+=2*i[s].velX,this.viewport.x-=2*i[s].velX,this.game.level.move(2*i[s].velX),this.onPlatform=!0),i[s].pl&&i[s].goesUp&&(this.onPlatform=!0)):this.onSlope(i[s],this)?e=i[s].y:(this.velX=0,this.jumping=!1),null!==h&&i[s].kill&&this.died(),null!==h&&"b"!==h&&i[s].isMonster&&!i[s].harmless&&(this.dead=!0,this.died()),null!==h&&i[s].exit&&this.game.level.next(),null!==h&&i[s].isKnight&&(this.game.state=1),null!==h&&i[s].pickup&&(this.chi+=1,i[s].dead=!0,this.chi>3&&(this.lives+=1,this.chi-=3)),null!==h&&i[s].next)for(var a=this.game.level.blockers,b=0;b<a.length;b++)if(a[b].dest){this.y=a[b].y;var n=-1*a[b].x-this.viewport.x+512;this.x-=n,this.viewport.x+=n,this.game.level.move(-1*n);break}}this.grounded&&!this.jumping&&(this.velY=0,this.cba=1,this.cha=1),this.grounded||!(this.velY>.2||this.velY<-.2)||this.onPlatform||(this.cba=2,this.cha=2),this.x+this.viewport.x>=this.viewport.minXmove&&this.x+this.viewport.x<=this.viewport.maxXmove||this.x+this.viewport.x<=this.viewport.minXmove&&this.velX>0||this.x+this.viewport.x>=this.viewport.maxXmove&&this.velX<0||Math.abs(this.viewport.x-this.game.gameSize.width)>=this.game.level.width-this.velX&&this.velX>0||this.viewport.x-this.velX>0&&this.velX<0||(this.viewport.x-=this.velX,this.game.level.move(this.velX)),this.x+this.velX>0&&this.x+this.width+this.velX<this.game.level.width&&(this.x+=this.velX),this.y+=this.velY,this.velX<.2&&this.velX>-.2&&this.grounded&&(this.cba=0,this.cha=0),this.y>770&&!this.dead&&this.died(),this.ab[this.cba].update(),this.ah[this.cha].update(),null!==this.holding&&(this.holding.x=this.x,this.holding.y=this.y-this.holding.height,this.holding.goingLeft=this.goingLeft)},colCheck:function(t,i){if(i.dead)return null;var s=t.x+t.width/2-(i.x+i.width/2),h=t.y+t.height/2-(i.y+i.height/2),e=t.width/2+i.width/2,a=t.height/2+i.height/2,b=null;if(Math.abs(s)<e&&Math.abs(h)<a){var n=e-Math.abs(s),r=a-Math.abs(h);n>=r?h>0?(b="t",i.tr||i.tl||i.pickup||(t.y+=r)):(b="b",i.tr||i.tl||i.pickup||(t.y-=r)):s>0?(b="l",i.tr||i.tl||i.pickup||(t.x+=n)):(b="r",i.tr||i.tl||i.pickup||(t.x-=n))}return b}},i.exports=s},{2:2}],11:[function(t,i){"use strict";function s(t,i,s){this.lvl=t,this.x=i,this.y=s,this.width=84,this.height=68,this.velX=0,this.speed=1,this.friction=.5,this.goingLeft=!1,this.dead=!1,this.kill=!0,this.isMonster=!0,this.isBoss=!0;var e=[[256,32,21,17,300,0],[277,32,28,26,300,0],[305,32,28,29,1e3,1,277,32,28,26,1e3,0]];this.anim={body:new h(this.lvl.parent.images[0],e[0]),w:new h(this.lvl.parent.images[0],e[1]),b:new h(this.lvl.parent.images[0],e[2])},this.blo=[],this.c="w",this.ho={b:[-12,-20],w:[-12,-20]},this.s="w",this.ts=(new Date).getTime(),this.tl=!1}var h=t(2),e=t(5);s.prototype={update:function(){if(this.dead&&this.y<1e3)this.y+=this.velY,this.x+=this.velX;else{if("w"===this.s){this.goingLeft?this.velX>-this.speed&&this.velX--:this.velX<this.speed&&this.velX++,this.velX*=this.friction;for(var t=this.blo,i=this.lvl.player,s=0;s<t.length;s++){var h=i.colCheck(this,t[s]);("l"===h||"r"===h)&&(this.goingLeft&&"w"===this.s&&this.tl?(this.s="s",this.c="b"):(this.velX=0,this.goingLeft=!this.goingLeft,"r"===h&&(this.tl=!0)))}this.x+=this.velX}else if("p"===this.s){var e=(new Date).getTime();e-this.ts>2e3&&(this.ts=e,this.s="w",this.c="w")}else{var e=(new Date).getTime();e-this.ts>100&&0===this.anim[this.c].c&&(this.shootFireball(),this.ts=e,this.s="p",this.tl=!1)}this.anim[this.c].update()}},render:function(t){var i=this.goingLeft,s=this.x+this.lvl.viewport.x;this.anim.body.render(t,i,s,this.y),this.anim[this.c].render(t,i,s+this.ho[this.c][this.goingLeft?0:1],this.y-96)},blockfilter:function(t){return t.isMonster||t.fb?!1:!0},shootFireball:function(){for(var t=[-1,0,-.2,-.2,-1,0,-.2,-.1,-1,0,-.2,.2,-1,0,-.2,0,-1,0,-.2,.1],i=0;i<t.length;i+=4){var s=new e(this.lvl,this.x,this.y-8,t[i],t[i+1],t[i+2],t[i+3]);this.lvl.things.push(s),this.lvl.blockers.push(s)}},dies:function(){this.dead=!0,this.velX=.75,this.velY=4;for(var t=this.lvl.things,i=0;i<t.length;i++)t[i].door&&(t[i].dead=!0)}},i.exports=s},{2:2,5:5}],12:[function(t,i){"use strict";var s=function(t,i,s,h,e,a){this.height=t.gameSize.height,this.width=t.gameSize.width,this.halfwidth=this.width/2,this.bgcolour=i,this.text=s,this.continueKey=h||null,this.keyWord=e,this.nextstate=a,this.g=t,this.lvl=null,this.d=1,this.ctr=0};s.prototype={render:function(t){null!==this.lvl&&this.lvl.render(t),t.fillStyle=this.bgcolour,t.globalAlpha=.75,t.fillRect(262,0,500,this.height),t.globalAlpha=1,t.font="40px Verdana",t.textAlign="center",t.fillStyle="#FFF";for(var i=100,s=0;s<this.text.length;s++)t.fillText(this.text[s],this.halfwidth,i),i+=40,s%2!==0&&(i+=30),t.font="24px Verdana";null!==this.continueKey&&t.fillText("Press "+this.continueKey+" to "+this.keyWord,this.halfwidth,this.height-80)},update:function(){null!==this.continueKey&&this.g.keyboarder.isDown(this.continueKey)&&(this.g.state=this.nextstate),null!==this.lvl&&(this.lvl.update(),this.lvl.move(this.d),this.ctr++,this.ctr>1200&&(this.d<0&&this.lvl.next(),this.d=-1*this.d,this.ctr=0))}},i.exports=s},{}],13:[function(t,i){"use strict";var s=function(t){this.width=t.width,this.height=t.height,this.x=0,this.y=0,this.minXmove=400,this.maxXmove=this.width-500};s.prototype={vis:function(t){if(t.isBoss)return!0;var i={r:t.x+t.width,l:t.x,t:t.y,b:t.y+t.height},s={r:-1*this.x+this.width,l:-1*this.x,t:this.y,b:this.y+this.height};return!(s.l>i.r||s.r<i.l||s.t>i.b||s.b<i.t)}},i.exports=s},{}]},{},[1]);