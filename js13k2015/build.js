!function t(i,e,s){function h(r,n){if(!e[r]){if(!i[r]){var b="function"==typeof require&&require;if(!n&&b)return b(r,!0);if(o)return o(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var l=e[r]={exports:{}};i[r][0].call(l.exports,function(t){var e=i[r][1][t];return h(e?e:t)},l,l.exports,t,i,e,s)}return e[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)h(s[r]);return h}({1:[function(t){!function(){"use strict";var i=t(3),e=t(7),s=t(4),h=null,o=0,r=1,n=2,b=3,a=4,l=function(){var t=this;this.images=[];var s=document.querySelector("#game");this.ctx=s.getContext("2d"),this.ctx.imageSmoothingEnabled=this.ctx.mozImageSmoothingEnabled=this.ctx.oImageSmoothingEnabled=!1,this.gameSize={width:s.width,height:s.height},this.state=o,this.keyboarder=new i,this.loadingScreen=new e(this,"#000",["Loading..."]),this.titleScreen=new e(this,"#6b036e",["Dragon Rescue","made for #js13k","Code by","madmarcel","Art by","surt"],"S","start",n),this.gameoverScreen=new e(this,"#000",["Game Over"],"R","try again",r),this.loadImages();var h=1e3/60,b=function(){t.render(),requestAnimationFrame(b)};b();var a=function(){t.update(),setTimeout(a,h)};a()};l.prototype={render:function(){switch(this.ctx.clearRect(0,0,this.gameSize.width,this.gameSize.height),this.state){case o:this.loadingScreen.render(this.ctx);break;case r:this.titleScreen.render(this.ctx);break;case b:this.level.render(this.ctx);break;case a:this.gameoverScreen.render(this.ctx)}},update:function(){switch(this.state){case o:this.loadingScreen.update();break;case r:this.titleScreen.update();break;case n:this.level=new s(0,this),this.state=b;break;case b:this.level.update();break;case a:this.gameoverScreen.update()}},loadImages:function(){for(var t=this,i=["spritesheet"],e=function(e){e>=i.length&&(t.state=n)},s=0,h=0;h<i.length;h++){var o=new Image;o.onload=function(){s++,e(s)},o.src=i[h]+".png",t.images[h]=o}}},window.addEventListener("load",function(){h=new l})}()},{3:3,4:4,7:7}],2:[function(t,i){"use strict";function e(t,i,e,s){this.x=t,this.y=i,this.width=e,this.height=s,this.tr=this.tl=this.dead=this.pickup=this.exit=this.pl=this.mb=!1,this.c="red"}e.prototype={getPolygon:function(){return this.tr?[{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height},{x:this.x+this.width,y:this.y}]:[{x:this.x,y:this.y},{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height}]},side_of_line:function(t,i,e){return(e.y-t.y)*(i.x-t.x)-(e.x-t.x)*(i.y-t.y)},point_inside_poly:function(t,i){for(var e=0;e<t.length-1;e++)if(this.side_of_line(t[e],t[e+1],i)>0)return!1;return this.side_of_line(t[t.length-1],t[0],i)>0?!1:!0}},i.exports=e},{}],3:[function(t,i){"use strict";var e=function(){var t=this;this.keyState={},window.addEventListener("keydown",function(i){t.preventKeys.indexOf(i.keyCode)>-1&&(i.preventDefault(),i.stopPropagation()),t.keyState[i.keyCode]=!0}),window.addEventListener("keyup",function(i){t.keyState[i.keyCode]=!1}),this.KEYS={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,ENTER:13,ESC:27};for(var i=65;91>i;i++)this.KEYS[String.fromCharCode(i)]=i;this.preventKeys=[this.KEYS.LEFT,this.KEYS.RIGHT,this.KEYS.UP,this.KEYS.DOWN,this.KEYS.SPACE,this.KEYS.ENTER,this.KEYS.ESC]};e.prototype={isDown:function(t){return this.keyState[this.KEYS[t]]===!0}},i.exports=e},{}],4:[function(t,i){"use strict";function e(t,i){this.number=t,this.player=null,this.data=[".........................................................................................................................................................................................................................................................................................................................................888..............................................................................$......$.@.........444...............................................................................VcUucv$.Xdx......$464....................................................................................aaaaa........444........nN....................................................................nn....aaaaa........444.......Imm...................................................................Immi...aYBya........464......IJsb...........................................................~n..kL.IJsoji.NzbbBZ.12N.N..4!4n..n.IJsbb..........................................................mmmmmmmmJsbbojMMMMMMMMMMMMMMMMMMmgGmmJsbbb..........................................................ooooooooobbbboooooooooooooooooooofFooobbbb..........................................................0","...................................................................................................................*.................................VcUucv..........................................................$..).$................................Tt..................n.nKLN.....................................VUuv....$n+N$...............nLN......Tt.................Immmmmmi...................888...............Tt.....Ghhhg.....]n$......GHHHg.....Tt................IJsoooooji..................444.....nnN.......Tt..............Immg................TtN.$n.].n.lN$$nlIJsbbbbbboji.LnN)))lk$.......464....Ghhhg......Ttn............IJoo................ImmmgGhhhhhhhhgGmmJswaaaaaaeojmmmmmmmmmi.......444..............Immmi..........IJsbblkn.......N....IJsoo............ooowaaaaaaaaeoooooooooob2......464.nlk~N..n....IJsooji........IJsbbbmmmg....GmmmilIJsbbb...........Ibbbaaaaaaaaaaaaaaaaaaaaa22.....4!4mmmmmmmmmg$kIJsbbboji......IJsbbbbooon.L...ooojmJsbbbb.-....KL..IJbbbyaaaaaaaaaaaaaaaaaaaa222.N.Immmooooooooo.GmJsbbbbboji-nkLIJsbbbbbbbbmmmg..bbbooobbbbbmmmmmmmmmmJsbbbbbbbbbbbyaazbbyaaaaazmmmmmmJsoobbbbbbbbbffoobbbbbbbojmmmmJsbbbbbbbbboooFFFbbbbbbbbbbbooooooooooobbbbbbbbbbbbbbbbbbbbbbbbbbbbbboobbb0","bbbbbbbbbbbbbbBBBBbbbbbBbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbgttttttttttvttGbgttttttGbgttttvtttttttttttttttttttVtttttttVtttttttVtttttttVtttttttV3333333bbbbbbbbbbg..........d..Gbg......Gbg....d...................D.......D.......D.......D.......D3333333bbbbbbbbbbg..........d..GPg......ttt....d...................D.......D.......D.......D.......D3333333btttttttvtt..........d.*Gbg.............c...................D.......D.......D.......D.......D3333333b.......d............d..ttt..........IhhF..............fHF..D.......D.......D.......D.......D3333333b.......d............d..............IJbPg.........XWwx.Gbg..D.......D.......D.......D.......D3333333b.......d............c.............IJbbbg.....(........Gbg..D.......D.......D.......D.......D3333333b.......d...........IhhHi.........IJbbbbg.....fHHF.....Gbg..D.......D.......D.......D.......D3q333q3b.......c.....l....IJBPbjhhF...Xx.Gbbbbbg.....tttt.....Gbg..D.......D.......D.......D.......D3335333b.~..IHHHHHHHHF..fhJBBBbbbbgyyyyyyGbbbbbg..............Gbji.C.......C.......C.......C.......C333!333bHHHHJBBBBBBBBgyyGbBBBBbbbbgzZZZZZGbbbbbgYYYYYYYYYYYYYYGbbjmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmb1"],this.parent=i,this.height=12,this.width=0,this.tilesize=16,this.scale=4,this.tileset=0,this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)}var s=t(6),h=t(8),o=t(5),r=t(2);e.prototype={rand:function(t,i){return Math.floor(Math.random()*(i-t+1))+t},genBG:function(t,i,e){if(1===this.tileset){for(var s=[10,15,16,17],h=0,o=0,r=0;100>r;r++)h=this.rand(0,i-1),o=this.rand(0,e-1),t[h][o]=14;for(o=5,h=this.rand(5,8);i>h;h+=this.rand(4,7)){var n=this.rand(0,3);o=this.rand(3,5),t[h][o]=s[n],3===n&&(t[h][o+1]=s[n]+1)}}else for(var b=[[17,0],[-16,-17],[16,15]],r=[[1,1,2,0],[0,0,1,1,2,0],[0,-1,2,-1,1,0]],a=0,l=0,m=this.rand(4,8),f=0;i>f;f++){t[f][m]=b[a][0],t[f][m+1]=b[a][1];for(var d=m+2;d<this.height;d++)t[f][d]=0;if(m>9){for(var g=-1;0>g;)l=2*this.rand(0,r[a].length/2-1),g=r[a][l+1];m-=r[a][l+1],a=r[a][l]}else if(2>m){for(var g=1;g>0;)l=2*this.rand(0,r[a].length/2-1),g=r[a][l+1];m-=r[a][l+1],a=r[a][l]}else l=2*this.rand(0,r[a].length/2-1),m-=r[a][l+1],a=r[a][l]}},genBlockers:function(t,i,e){this.blockers=[];var h=[];this.emptyTilemap(h,i,e,this.tileset-1);for(var n=this.tilesize*this.scale,b={player:["~"],exit:["!"],monster1:["&","*","(",")","-","+","[","]","{","}"],monster2:[],items:[],chilli:["*"],monsterblock:["$"],ignore:["3","4","5","6","7","8"]},a=[{t_l:[-24,-8,25],t_r:[8,-7,24],ign:[6,-26,10,-22,11,-21,-13,19,-19,13,-32,0],half:[7,-25,-11,21,-12,20,-30,2],plat:[-29,3,-9,23],dead:[5,-27],item:[-28,4,-10,22]},{t_l:[-24],t_r:[8],ign:[-21,11,-19,13,-30,2,-29,3,-17,15,-16,16],half:[-13,19,-11,21],plat:[-10,22,-9,23],dead:[-7,25,-8,24],item:[]}],l=[],m=a[this.tileset],f=b,d=0;e>d;d++)for(var g=0;i>g;g++){var u=t[g][d],c=String.fromCharCode(u+97);if(-51!==u){var v=new r(g*n,d*n,n,n),p=!1;if(f.player.indexOf(c)>-1){p=!0;var x={b:null,c:null};this.createImage(100,20,x),this.player=new s(this.parent,g*n,d*n,this.viewport),this.player.init(x),t[g][d]=-51}if(this.io(f.monsterblock,c)&&(v.mb=!0,p=!1),f.monster1.indexOf(c)>-1&&(p=!0),f.ignore.indexOf(c)>-1&&(p=!0),this.io(f.exit,c)&&(v.exit=!0),this.io(m.plat,u)){for(var w=g*n,y=d*n,S=g,D=t[S][d];this.io(m.plat,D);)t[S][d]=-51,S++,D=t[S][d];var x={b:null,c:null};this.createImage(S*n-w,n,x);var I=new o(this,x,S*n-w,n/2,w,y);I.init(this.tileset,this.tilesize,this.tilesize*this.scale,S-g),this.platforms.push(I),this.blockers.push(I),p=!0}m.t_l.indexOf(u)>-1?(v.c="white",v.tr=!0,l.push([g,d+1])):m.t_r.indexOf(u)>-1?(v.c="orange",v.tl=!0,l.push([g,d+1])):m.half.indexOf(u)>-1?(v.height=n/2,v.c="blue"):m.ign.indexOf(u)>-1?p=!0:m.dead.indexOf(u)>-1?(v.c="cyan",v.dead=!0,v.y+=n/2,v.height=n/2):m.item.indexOf(u)>-1?(v.c="yellow",v.pickup=!0):m.plat.indexOf(u)>-1&&(v.c="white");for(var k=0;k<l.length;k++)l[k][0]===g&&l[k][1]===d&&(p=!0);p||this.blockers.push(v)}}this.player.boxes=this.blockers},init:function(t,i){this.viewport=new h(this.parent.gameSize);var e=[];this.tileset=parseInt(this.data[this.number][this.data[this.number].length-1],10),this.emptyTilemap(e,t.w,this.height,this.tileset-1),i?(this.convertTilemap(e,this.data[this.number],t.w),this.genBlockers(e,t.w,this.height)):this.genBG(e,t.w,this.height),this.createImage(t.w*this.tilesize*this.scale,this.parent.gameSize.height,t),this.drawTileMap(t.c,e,this.height,t.w)},update:function(){this.player.update();for(var t=0;t<this.platforms.length;t++)this.platforms[t].update()},render:function(t){for(var i=0;i<this.buffers.length;i++)null!==this.buffers[i].b&&t.drawImage(this.buffers[i].b,Math.floor(this.buffers[i].xo),0,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height);var e=0,s=this.platforms.filter(this.viewport.vis);for(e=0;e<s.length;e++)s[e].render(t,Math.floor(this.viewport.x));this.player.render(t,Math.floor(this.buffers[1].xo))},drawTile:function(t,i,e,s,h,o){if(!(0>i)){var r=this.tilesize*this.scale,n=this.tileset;o>-1&&(n=o),h?(t.save(),t.translate(t.canvas.width,0),t.scale(-1,1),t.drawImage(this.parent.images[0],i*this.tilesize,n*this.tilesize,this.tilesize,this.tilesize,t.canvas.width-e*r-r,s*r,r,r),t.restore()):t.drawImage(this.parent.images[0],i*this.tilesize,n*this.tilesize,this.tilesize,this.tilesize,e*r,s*r,r,r)}},createImage:function(t,i,e){var s=document.createElement("canvas");s.width=t,s.height=i;var h=s.getContext("2d");h.imageSmoothingEnabled=h.mozImageSmoothingEnabled=h.oImageSmoothingEnabled=!1,e.b=s,e.c=h},move:function(t){this.buffers[1].xo+=t,this.buffers[0].xo+=t/2},emptyTilemap:function(t,i,e,s){for(var h=0;i>h;h++){t[h]=[];for(var o=0;e>o;o++)t[h].push(s)}},convertTilemap:function(t,i,e){for(var s=0,h=0,o=0;o<i.length;o++)t[s][h]=i[o].charCodeAt()-97,s++,s>e-1&&(s=0,h++)},drawTileMap:function(t,i,e,s){for(var h=["2","4","6","8"],o=["1","3","5","7"],r=["!"],n=!1,b=-1,a=0;e>a;a++)for(var l=0;s>l;l++){var m=String.fromCharCode(i[l][a]+97);n=!1,i[l][a]<-6&&(i[l][a]+=32,n=!0),this.io(h,m)&&(b=2,i[l][a]=parseInt(m,10)/2+2,n=!1),this.io(o,m)&&(b=3,i[l][a]=(parseInt(m,10)+1)/2+2,n=!1),this.io(r,m)&&(i[l][a]=0,b=0),this.drawTile(t,i[l][a],l,a,n,b),b=-1}},io:function(t,i){return t.indexOf(i)>-1},next:function(){this.number++,this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)},setup:function(){this.buffers=[{b:null,c:null,w:80,xo:0},{b:null,c:null,w:100,xo:0}],this.width=this.buffers[1].w*this.tilesize*this.scale,this.blockers=[],this.platforms=[],this.viewport=null}},i.exports=e},{2:2,5:5,6:6,8:8}],5:[function(t,i){"use strict";var e=function(t,i,e,s,h,o){this.x=h,this.y=o,this.width=e,this.height=s,this.lvl=t,this.buffer=i,this.velX=0,this.velY=0,this.speed=3,this.pl=!0,this.isHor=!0};e.prototype={render:function(t,i){t.drawImage(this.buffer.b,this.x+i,this.y)},update:function(){var t=this.lvl.blockers.filter(this.lvl.viewport.vis);t=t.filter(function(t){return!t.pl});for(var i=0;i<t.length;i++){var e=this.lvl.player.colCheck(this,t[i]);this.isHor&&("l"===e&&(this.velX=1),"r"===e&&(this.velX=-1))}this.x+=this.velX},init:function(t,i,e,s){var h=[[23,3,23],[23,22,23]],o=[],r=0;for(o.push(h[t][0]),r=0;s-2>r;r++)o.push(h[t][1]);o.push(h[t][2]);var n=!0;for(r=0;r<o.length;r++)this.lvl.drawTile(this.buffer.c,o[r],r,0,n,t),n=!1;this.isHor&&(this.velX=1)}},i.exports=e},{}],6:[function(t,i){"use strict";function e(t,i,e,s){this.game=t,this.viewport=s,this.x=i,this.y=e,this.width=64,this.height=64,this.boxes=[],this.mx=this.x+this.width/2,this.by=this.y+this.height,this.velX=0,this.velY=0,this.speed=5,this.jumping=!1,this.gravity=.2,this.grounded=!0,this.friction=.9,this.goingLeft=!1,this.vx=0,this.ss=null}e.prototype={init:function(t){this.ss=t;var i=[[0,0,16,11]],e=0;for(e=0;e<i.length;e++);},di:function(t,i,e,s,h,o,r,n){t.drawImage(this.game.images[0],i,e,s,h,o,r,s*n,h*n)},onSlope:function(t,i){if(t.tr||t.tl){var e=t.x,s=t.y+t.height;if(t.tr){var h=Math.floor(s-(i.x+i.width/2-e));i.y>=h-i.height&&(i.y=h-i.height,i.velY=0,i.grounded=!0,i.jumping=!1)}else if(t.tl){var h=Math.floor(s-(t.height-(i.x+i.width/2-e)));i.y>=h-i.height&&(i.y=h-i.height,i.velY=0,i.grounded=!0,i.jumping=!1)}return!0}return!1},update:function(){this.game.keyboarder.isDown("LEFT")&&(this.velX>-this.speed&&this.velX--,this.goingLeft=!0),this.game.keyboarder.isDown("RIGHT")&&(this.velX<this.speed&&this.velX++,this.goingLeft=!1),(this.game.keyboarder.isDown("SPACE")||this.game.keyboarder.isDown("UP"))&&!this.jumping&&this.grounded&&(this.jumping=!0,this.grounded=!1,this.velY=2*-this.speed),this.velX*=this.friction,this.velY+=this.gravity,this.grounded=!1;var t=this.boxes.filter(this.viewport.vis);t=t.filter(function(t){return!t.mb});var i=-1;this.goingLeft&&t.reverse();for(var e=0;e<t.length;e++)if(t[e].y!==i){var s=this.colCheck(this,t[e]);"l"===s||"r"===s?this.onSlope(t[e],this)?i=t[e].y:(this.velX=0,this.jumping=!1):"b"===s?this.onSlope(t[e],this)?i=t[e].y:(this.grounded=!0,this.jumping=!1,t[e].pl&&this.velX<.2&&(this.x+=2*t[e].velX,this.viewport.x-=2*t[e].velX,this.game.level.move(2*t[e].velX))):"t"===s&&(this.velY*=-1),null!==s&&t[e].exit&&this.game.level.next()}this.grounded&&(this.velY=0),this.x+this.viewport.x>=this.viewport.minXmove&&this.x+this.viewport.x<=this.viewport.maxXmove||this.x+this.viewport.x<=this.viewport.minXmove&&this.velX>0||this.x+this.viewport.x>=this.viewport.maxXmove&&this.velX<0||Math.abs(this.viewport.x-this.game.gameSize.width)>=this.game.level.width-this.velX&&this.velX>0||this.viewport.x-this.velX>0&&this.velX<0||(this.viewport.x-=this.velX,this.game.level.move(this.velX)),this.x+this.velX>0&&this.x+this.width+this.velX<this.game.level.width&&(this.x+=this.velX),this.y+=this.velY},render:function(t){t.fillStyle="red",t.beginPath(),t.fillRect(this.x+this.viewport.x,this.y,this.width,this.height)},colCheck:function(t,i){var e=t.x+t.width/2-(i.x+i.width/2),s=t.y+t.height/2-(i.y+i.height/2),h=t.width/2+i.width/2,o=t.height/2+i.height/2,r=null;if(Math.abs(e)<h&&Math.abs(s)<o){var n=h-Math.abs(e),b=o-Math.abs(s);n>=b?s>0?(r="t",i.tr||i.tl||(t.y+=b)):(r="b",i.tr||i.tl||(t.y-=b)):e>0?(r="l",i.tr||i.tl||(t.x+=n)):(r="r",i.tr||i.tl||(t.x-=n))}return r}},i.exports=e},{}],7:[function(t,i){"use strict";var e=function(t,i,e,s,h,o){this.height=t.gameSize.height,this.width=t.gameSize.width,this.halfwidth=this.width/2,this.bgcolour=i,this.text=e,this.continueKey=s||null,this.keyWord=h,this.nextstate=o,this.game=t};e.prototype={render:function(t){t.fillStyle=this.bgcolour,t.fillRect(0,0,this.width,this.height),t.font="30px Verdana",t.textAlign="center",t.fillStyle="#FFF";for(var i=100,e=0;e<this.text.length;e++)t.fillText(this.text[e],this.halfwidth,i),i+=40,e%2!==0&&(i+=30,t.font="24px Verdana");null!==this.continueKey&&t.fillText("Press "+this.continueKey+" to "+this.keyWord,this.halfwidth,this.height-80)},update:function(){null!==this.continueKey&&this.game.keyboarder.isDown(this.continueKey)&&(this.game.state=this.nextstate)}},i.exports=e},{}],8:[function(t,i){"use strict";var e=function(t){this.width=t.width,this.height=t.height,this.x=0,this.y=0,this.minXmove=400,this.maxXmove=this.width-500};e.prototype={vis:function(t){var i={r:t.x+t.width,l:t.x,t:t.y,b:t.y+t.height},e={r:self.x+self.width,l:self.x,t:self.y,b:self.y+self.height};return!(e.l>i.r||e.r<i.l||e.t>i.b||e.b<i.t)}},i.exports=e},{}]},{},[1]);