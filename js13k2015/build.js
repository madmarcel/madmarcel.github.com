!function t(i,e,s){function h(b,r){if(!e[b]){if(!i[b]){var n="function"==typeof require&&require;if(!r&&n)return n(b,!0);if(o)return o(b,!0);var a=new Error("Cannot find module '"+b+"'");throw a.code="MODULE_NOT_FOUND",a}var l=e[b]={exports:{}};i[b][0].call(l.exports,function(t){var e=i[b][1][t];return h(e?e:t)},l,l.exports,t,i,e,s)}return e[b].exports}for(var o="function"==typeof require&&require,b=0;b<s.length;b++)h(s[b]);return h}({1:[function(t){!function(){"use strict";var i=t(3),e=t(7),s=t(4),h=null,o=0,b=1,r=2,n=3,a=4,l=function(){var t=this;this.images=[];var s=document.querySelector("#game");this.ctx=s.getContext("2d"),this.ctx.imageSmoothingEnabled=this.ctx.mozImageSmoothingEnabled=this.ctx.oImageSmoothingEnabled=!1,this.gameSize={width:s.width,height:s.height},this.state=o,this.keyboarder=new i,this.loadingScreen=new e(this,"#000",["Loading..."]),this.titleScreen=new e(this,"#6b036e",["Dragon Rescue","made for #js13k","Code by","madmarcel","Art by","surt"],"S","start",r),this.gameoverScreen=new e(this,"#000",["Game Over"],"R","try again",b),this.loadImages();var h=1e3/60,n=function(){t.render(),requestAnimationFrame(n)};n();var a=function(){t.update(),setTimeout(a,h)};a()};l.prototype={render:function(){switch(this.ctx.clearRect(0,0,this.gameSize.width,this.gameSize.height),this.state){case o:this.loadingScreen.render(this.ctx);break;case b:this.titleScreen.render(this.ctx);break;case n:this.level.render(this.ctx);break;case a:this.gameoverScreen.render(this.ctx)}},update:function(){switch(this.state){case o:this.loadingScreen.update();break;case b:this.titleScreen.update();break;case r:this.level=new s(0,this),this.state=n;break;case n:this.level.update();break;case a:this.gameoverScreen.update()}},loadImages:function(){for(var t=this,i=["spritesheet"],e=function(e){e>=i.length&&(t.state=r)},s=0,h=0;h<i.length;h++){var o=new Image;o.onload=function(){s++,e(s)},o.src=i[h]+".png",t.images[h]=o}}},window.addEventListener("load",function(){h=new l})}()},{3:3,4:4,7:7}],2:[function(t,i){"use strict";function e(t,i,e,s){this.x=t,this.y=i,this.width=e,this.height=s,this.tr=this.tl=this.dead=this.pickup=this.exit=this.pl=this.mb=!1,this.c="red"}e.prototype={getPolygon:function(){return this.tr?[{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height},{x:this.x+this.width,y:this.y}]:[{x:this.x,y:this.y},{x:this.x,y:this.y+this.height},{x:this.x+this.width,y:this.y+this.height}]},side_of_line:function(t,i,e){return(e.y-t.y)*(i.x-t.x)-(e.x-t.x)*(i.y-t.y)},point_inside_poly:function(t,i){for(var e=0;e<t.length-1;e++)if(this.side_of_line(t[e],t[e+1],i)>0)return!1;return this.side_of_line(t[t.length-1],t[0],i)>0?!1:!0}},i.exports=e},{}],3:[function(t,i){"use strict";var e=function(){var t=this;this.keyState={},window.addEventListener("keydown",function(i){t.preventKeys.indexOf(i.keyCode)>-1&&(i.preventDefault(),i.stopPropagation()),t.keyState[i.keyCode]=!0}),window.addEventListener("keyup",function(i){t.keyState[i.keyCode]=!1}),this.KEYS={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,ENTER:13,ESC:27};for(var i=65;91>i;i++)this.KEYS[String.fromCharCode(i)]=i;this.preventKeys=[this.KEYS.LEFT,this.KEYS.RIGHT,this.KEYS.UP,this.KEYS.DOWN,this.KEYS.SPACE,this.KEYS.ENTER,this.KEYS.ESC]};e.prototype={isDown:function(t){return this.keyState[this.KEYS[t]]===!0}},i.exports=e},{}],4:[function(t,i){"use strict";function e(t,i){this.number=t,this.player=null,this.data=[".........................................................................................................................................................................................................................................................................................................................................888..............................................................................$......$.@.........444...............................................................................VcUucv$.Xdx......$464....................................................................................aaaaa........444........nN....................................................................nn....aaaaa........444.......Imm...................................................................Immi...aYBya........464......IJsb...........................................................~n..kL.IJsoji.NzbbBZ.12N.N..4!4n..n.IJsbb..........................................................mmmmmmmmJsbbojMMMMMMMMMMMMMMMMMMmgGmmJsbbb..........................................................ooooooooobbbboooooooooooooooooooofFooobbbb..........................................................0","...................................................................................................................*.................................VcUucv..........................................................$..).$................................Tt..................n.nKLN.....................................VUuv....$n+N$...............nLN......Tt.................Immmmmmi...................888...............Tt.....Ghhhg.....]n$......GHHHg.....Tt................IJsoooooji..................444.....nnN.......Tt..............Immg................TtN.$n.].n.lN$$nlIJsbbbbbboji.LnN)))lk$.......464....Ghhhg......Ttn............IJoo................ImmmgGhhhhhhhhgGmmJswaaaaaaeojmmmmmmmmmi.......444..............Immmi..........IJsbblkn.......N....IJsoo............ooowaaaaaaaaeoooooooooob2......464.nlk~N..n....IJsooji........IJsbbbmmmg....GmmmilIJsbbb...........Ibbbaaaaaaaaaaaaaaaaaaaaa22.....4!4mmmmmmmmmg$kIJsbbboji......IJsbbbbooon.L...ooojmJsbbbb.-....KL..IJbbbyaaaaaaaaaaaaaaaaaaaa222.N.Immmooooooooo.GmJsbbbbboji-nkLIJsbbbbbbbbmmmg..bbbooobbbbbmmmmmmmmmmJsbbbbbbbbbbbyaazbbyaaaaazmmmmmmJsoobbbbbbbbbffoobbbbbbbojmmmmJsbbbbbbbbboooFFFbbbbbbbbbbbooooooooooobbbbbbbbbbbbbbbbbbbbbbbbbbbbbboobbb0","bbbbbbbbbbbbbbBBBBbbbbbBbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbgttttttttttvttGbgttttttGbgttttvtttttttttttttttttttVtttttttVtttttttVtttttttVtttttttV3333333bbbbbbbbbbg..........d..Gbg......Gbg....d...................D.......D.......D.......D.......D3333333bbbbbbbbbbg..........d..GPg......ttt....d...................D.......D.......D.......D.......D3333333btttttttvtt..........d.*Gbg.............c...................D.......D.......D.......D.......D3333333b.......d............d..ttt..........IhhF..............fHF..D.......D.......D.......D.......D3333333b.......d............d..............IJbPg.........XWwx.Gbg..D.......D.......D.......D.......D3333333b.......d............c.............IJbbbg.....(........Gbg..D.......D.......D.......D.......D3333333b.......d...........IhhHi.........IJbbbbg.....fHHF.....Gbg..D.......D.......D.......D.......D3q333q3b.......c.....l....IJBPbjhhF...Xx.Gbbbbbg.....tttt.....Gbg..D.......D.......D.......D.......D3335333b.~..IHHHHHHHHF..fhJBBBbbbbgyyyyyyGbbbbbg..............Gbji.C.......C.......C.......C.......C333!333bHHHHJBBBBBBBBgyyGbBBBBbbbbgzZZZZZGbbbbbgYYYYYYYYYYYYYYGbbjmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmmb1"],this.parent=i,this.height=12,this.width=0,this.tilesize=16,this.scale=4,this.tileset=0,this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)}var s=t(6),h=t(8),o=t(5),b=t(2);e.prototype={rand:function(t,i){return Math.floor(Math.random()*(i-t+1))+t},genBG:function(t,i,e){if(1===this.tileset){for(var s=[10,15,16,17],h=0,o=0,b=0;100>b;b++)h=this.rand(0,i-1),o=this.rand(0,e-1),t[h][o]=14;for(o=5,h=this.rand(5,8);i>h;h+=this.rand(4,7)){var r=this.rand(0,3);o=this.rand(3,5),t[h][o]=s[r],3===r&&(t[h][o+1]=s[r]+1)}}else for(var n=[[17,0],[-16,-17],[16,15]],b=[[1,1,2,0],[0,0,1,1,2,0],[0,-1,2,-1,1,0]],a=0,l=0,m=this.rand(4,8),f=0;i>f;f++){t[f][m]=n[a][0],t[f][m+1]=n[a][1];for(var d=m+2;d<this.height;d++)t[f][d]=0;if(m>9){for(var g=-1;0>g;)l=2*this.rand(0,b[a].length/2-1),g=b[a][l+1];m-=b[a][l+1],a=b[a][l]}else if(2>m){for(var g=1;g>0;)l=2*this.rand(0,b[a].length/2-1),g=b[a][l+1];m-=b[a][l+1],a=b[a][l]}else l=2*this.rand(0,b[a].length/2-1),m-=b[a][l+1],a=b[a][l]}},genBlockers:function(t,i,e){this.blockers=[];var h=[];this.emptyTilemap(h,i,e,this.tileset-1);for(var r=this.tilesize*this.scale,n={player:["~"],exit:["!"],monster1:["&","*","(",")","-","+","[","]","{","}"],monster2:[],items:[],chilli:["*"],monsterblock:["$"],ignore:["3","4","5","6","7","8"]},a=[{t_l:[-24,-8,25],t_r:[8,-7,24],ign:[6,-26,10,-22,11,-21,-13,19,-19,13,-32,0],half:[7,-25,-11,21,-12,20,-30,2],plat:[-29,3,-9,23],dead:[5,-27],item:[-28,4,-10,22]},{t_l:[-24],t_r:[8],ign:[-21,11,-19,13,-30,2,-29,3,-17,15,-16,16],half:[-13,19,-11,21],plat:[-10,22,-9,23],dead:[-7,25,-8,24],item:[]}],l=a[this.tileset],m=n,f=0;e>f;f++){h.push([]);for(var d=0;i>d;d++){var g=t[d][f];h[d][f]=g;var c=String.fromCharCode(g+97);if(-51!==g){var u=new b(d*r,f*r,r,r),v=!1;if(m.player.indexOf(c)>-1&&(v=!0,this.player=new s(this.parent,d*r,f*r,this.viewport),t[d][f]=-51),this.io(m.monsterblock,c)&&(u.mb=!0,v=!1),m.monster1.indexOf(c)>-1&&(v=!0),m.ignore.indexOf(c)>-1&&(v=!0),this.io(m.exit,c)&&(u.exit=!0),this.io(l.plat,g)){for(var p=d*r,x=f*r,w=d,y=t[w][f];this.io(l.plat,y);)t[w][f]=-51,w++,y=t[w][f];var D={b:null,c:null};this.createImage(w*r-p,r,D);var I=new o(this,D,w*r-p,r/2,p,x);I.init(this.tileset,this.tilesize,this.tilesize*this.scale,w-d),this.platforms.push(I),this.blockers.push(I),v=!0}l.t_l.indexOf(g)>-1?(u.c="white",u.tr=!0):l.t_r.indexOf(g)>-1?(u.c="orange",u.tl=!0):l.half.indexOf(g)>-1?(u.height=r/2,u.c="blue"):l.ign.indexOf(g)>-1?v=!0:l.dead.indexOf(g)>-1?(u.c="cyan",u.dead=!0,u.y+=r/2,u.height=r/2):l.item.indexOf(g)>-1?(u.c="yellow",u.pickup=!0):l.plat.indexOf(g)>-1&&(u.c="white"),v||this.blockers.push(u),h[d][f]="*"}else h[d][f]=" "}}this.player.boxes=this.blockers},init:function(t,i){this.viewport=new h(this.parent.gameSize);var e=[];this.tileset=parseInt(this.data[this.number][this.data[this.number].length-1],10),this.emptyTilemap(e,t.w,this.height,this.tileset-1),i?(this.convertTilemap(e,this.data[this.number],t.w),this.genBlockers(e,t.w,this.height)):this.genBG(e,t.w,this.height),this.createImage(t.w*this.tilesize*this.scale,this.parent.gameSize.height,t),this.drawTileMap(t.c,e,this.height,t.w)},update:function(){this.player.update();for(var t=0;t<this.platforms.length;t++)this.platforms[t].update()},render:function(t){for(var i=0;i<this.buffers.length;i++)null!==this.buffers[i].b&&t.drawImage(this.buffers[i].b,Math.floor(this.buffers[i].xo),0,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height);var e=0,s=this.platforms.filter(this.viewport.vis);for(e=0;e<s.length;e++)s[e].render(t,Math.floor(this.viewport.x));this.player.render(t,Math.floor(this.buffers[1].xo))},drawTile:function(t,i,e,s,h,o){if(!(0>i)){var b=this.tilesize*this.scale,r=this.tileset;o>-1&&(r=o),h?(t.save(),t.translate(t.canvas.width,0),t.scale(-1,1),t.drawImage(this.parent.images[0],i*this.tilesize,r*this.tilesize,this.tilesize,this.tilesize,t.canvas.width-e*b-b,s*b,b,b),t.restore()):t.drawImage(this.parent.images[0],i*this.tilesize,r*this.tilesize,this.tilesize,this.tilesize,e*b,s*b,b,b)}},createImage:function(t,i,e){var s=document.createElement("canvas");s.width=t,s.height=i;var h=s.getContext("2d");h.imageSmoothingEnabled=h.mozImageSmoothingEnabled=h.oImageSmoothingEnabled=!1,e.b=s,e.c=h},move:function(t){this.buffers[1].xo+=t,this.buffers[0].xo+=t/2},emptyTilemap:function(t,i,e,s){for(var h=0;i>h;h++){t[h]=[];for(var o=0;e>o;o++)t[h].push(s)}},convertTilemap:function(t,i,e){for(var s=0,h=0,o=0;o<i.length;o++)t[s][h]=i[o].charCodeAt()-97,s++,s>e-1&&(s=0,h++)},drawTileMap:function(t,i,e,s){for(var h=["2","4","6","8"],o=["1","3","5","7"],b=["!"],r=!1,n=-1,a=0;e>a;a++)for(var l=0;s>l;l++){var m=String.fromCharCode(i[l][a]+97);r=!1,i[l][a]<-6&&(i[l][a]+=32,r=!0),this.io(h,m)&&(n=2,i[l][a]=parseInt(m,10)/2+2,r=!1),this.io(o,m)&&(n=3,i[l][a]=(parseInt(m,10)+1)/2+2,r=!1),this.io(b,m)&&(i[l][a]=0,n=0),this.drawTile(t,i[l][a],l,a,r,n),n=-1}},io:function(t,i){return t.indexOf(i)>-1},next:function(){this.number++,this.setup(),this.init(this.buffers[0],!1),this.init(this.buffers[1],!0)},setup:function(){this.buffers=[{b:null,c:null,w:80,xo:0},{b:null,c:null,w:100,xo:0}],this.width=this.buffers[1].w*this.tilesize*this.scale,this.blockers=[],this.platforms=[],this.viewport=null}},i.exports=e},{2:2,5:5,6:6,8:8}],5:[function(t,i){"use strict";var e=function(t,i,e,s,h,o){this.x=h,this.y=o,this.width=e,this.height=s,this.lvl=t,this.buffer=i,this.velX=0,this.velY=0,this.speed=3,this.pl=!0,this.isHor=!0};e.prototype={render:function(t,i){t.drawImage(this.buffer.b,this.x+i,this.y)},update:function(){var t=this.lvl.blockers.filter(this.lvl.viewport.vis);t=t.filter(function(t){return!t.pl});for(var i=0;i<t.length;i++){var e=this.lvl.player.colCheck(this,t[i]);this.isHor&&("l"===e&&(this.velX=1),"r"===e&&(this.velX=-1))}this.x+=this.velX},init:function(t,i,e,s){var h=[[23,3,23],[23,22,23]],o=[],b=0;for(o.push(h[t][0]),b=0;s-2>b;b++)o.push(h[t][1]);o.push(h[t][2]);var r=!0;for(b=0;b<o.length;b++)this.lvl.drawTile(this.buffer.c,o[b],b,0,r,t),r=!1;this.isHor&&(this.velX=1)}},i.exports=e},{}],6:[function(t,i){"use strict";function e(t,i,e,s){this.game=t,this.viewport=s,this.x=i,this.y=e,this.width=64,this.height=64,this.boxes=[],this.mx=this.x+this.width/2,this.by=this.y+this.height,this.velX=0,this.velY=0,this.speed=5,this.jumping=!1,this.gravity=.2,this.grounded=!0,this.friction=.9,this.goingLeft=!1,this.vx=0}e.prototype={update:function(){this.game.keyboarder.isDown("LEFT")&&(this.velX>-this.speed&&this.velX--,this.goingLeft=!0),this.game.keyboarder.isDown("RIGHT")&&(this.velX<this.speed&&this.velX++,this.goingLeft=!1),(this.game.keyboarder.isDown("SPACE")||this.game.keyboarder.isDown("UP"))&&!this.jumping&&this.grounded&&(this.jumping=!0,this.grounded=!1,this.velY=2*-this.speed),this.velX*=this.friction,this.velY+=this.gravity,this.grounded=!1;var t=this.boxes.filter(this.viewport.vis);t=t.filter(function(t){return!t.mb});for(var i=0;i<t.length;i++){var e=this.colCheck(this,t[i]);"l"!==e&&"r"!==e||t[i].tr||t[i].tl?"b"===e?(this.grounded=!0,this.jumping=!1,t[i].pl&&this.velX<.2&&(this.x+=2*t[i].velX,this.viewport.x-=2*t[i].velX,this.game.level.move(2*t[i].velX))):"t"===e&&(this.velY*=-1):(this.velX=0,this.jumping=!1),null!==e&&t[i].exit&&(console.log("exit!"),this.game.level.next())}this.grounded&&(this.velY=0),this.x+this.viewport.x>=this.viewport.minXmove&&this.x+this.viewport.x<=this.viewport.maxXmove||this.x+this.viewport.x<=this.viewport.minXmove&&this.velX>0||this.x+this.viewport.x>=this.viewport.maxXmove&&this.velX<0||Math.abs(this.viewport.x-this.game.gameSize.width)>=this.game.level.width-this.velX&&this.velX>0||this.viewport.x-this.velX>0&&this.velX<0||(this.viewport.x-=this.velX,this.game.level.move(this.velX)),this.x+this.velX>0&&this.x+this.width+this.velX<this.game.level.width&&(this.x+=this.velX),this.y+=this.velY},render:function(t){t.fillStyle="red",t.beginPath(),t.fillRect(this.x+this.viewport.x,this.y,this.width,this.height)},colCheck:function(t,i){var e=t.x+t.width/2-(i.x+i.width/2),s=t.y+t.height/2-(i.y+i.height/2),h=t.width/2+i.width/2,o=t.height/2+i.height/2,b=null;if(Math.abs(e)<h&&Math.abs(s)<o){var r=h-Math.abs(e),n=o-Math.abs(s);r>=n?s>0?(b="t",t.y+=n):(b="b",t.y-=n):e>0?(b="l",t.x+=r):(b="r",t.x-=r)}return b}},i.exports=e},{}],7:[function(t,i){"use strict";var e=function(t,i,e,s,h,o){this.height=t.gameSize.height,this.width=t.gameSize.width,this.halfwidth=this.width/2,this.bgcolour=i,this.text=e,this.continueKey=s||null,this.keyWord=h,this.nextstate=o,this.game=t};e.prototype={render:function(t){t.fillStyle=this.bgcolour,t.fillRect(0,0,this.width,this.height),t.font="30px Verdana",t.textAlign="center",t.fillStyle="#FFF";for(var i=100,e=0;e<this.text.length;e++)t.fillText(this.text[e],this.halfwidth,i),i+=40,e%2!==0&&(i+=30,t.font="24px Verdana");null!==this.continueKey&&t.fillText("Press "+this.continueKey+" to "+this.keyWord,this.halfwidth,this.height-80)},update:function(){null!==this.continueKey&&this.game.keyboarder.isDown(this.continueKey)&&(this.game.state=this.nextstate)}},i.exports=e},{}],8:[function(t,i){"use strict";var e=function(t){this.width=t.width,this.height=t.height,this.x=0,this.y=0,this.minXmove=400,this.maxXmove=this.width-500};e.prototype={vis:function(t){var i={r:t.x+t.width,l:t.x,t:t.y,b:t.y+t.height},e={r:self.x+self.width,l:self.x,t:self.y,b:self.y+self.height};return!(e.l>i.r||e.r<i.l||e.t>i.b||e.b<i.t)}},i.exports=e},{}]},{},[1]);